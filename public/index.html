<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Linux Campaign — Light</title>
<style>
  :root{--bg:#f5f7fb;--card:#fff;--brd:#e6e8ef;--txt:#0f172a;--muted:#64748b;--acc:#2563eb;--radius:16px}
  *{box-sizing:border-box}html,body{height:100%}body{margin:0;background:linear-gradient(180deg,#fbfdff,#f5f7fb);color:var(--txt);font:15px/1.55 -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto}
  .layout{display:grid;grid-template-columns:260px 1fr;height:100vh}
  .glass{background:var(--card);border:1px solid var(--brd);border-radius:var(--radius);box-shadow:0 8px 26px rgba(15,23,42,.06)}
  header{height:64px;display:flex;align-items:center;justify-content:space-between;padding:0 14px}
  .nav{padding:12px}.nav a{display:block;padding:10px 12px;margin:6px 0;border-radius:12px;text-decoration:none;color:var(--txt)}
  .nav a.active{background:rgba(37,99,235,.08)}
  input,textarea,select{width:100%;background:#fff;border:1px solid var(--brd);border-radius:12px;padding:10px}
  .btn{border:1px solid var(--brd);background:#fff;border-radius:12px;padding:9px 12px;cursor:pointer}
  .btn.primary{background:linear-gradient(180deg,#60a5fa,#2563eb);color:#f8fafc;border-color:#3b82f6}
  .btn.warn{background:linear-gradient(180deg,#fde68a,#eab308)}
  .btn.danger{background:linear-gradient(180deg,#fecaca,#ef4444);color:#7f1d1d}
  .badge{display:inline-block;background:#eef2ff;color:#1e3a8a;border-radius:999px;padding:4px 10px;font-size:12px}
  .muted{color:var(--muted)}.mono{font-family:ui-monospace,Menlo,Consolas,monospace}
  .row{display:grid;gap:12px}@media(min-width:900px){.cols-2{grid-template-columns:1fr 1fr}.cols-3{grid-template-columns:repeat(3,1fr)}}
  table{width:100%;border-collapse:collapse}thead th{position:sticky;top:0;background:#f8fafc;border-bottom:1px solid var(--brd);text-align:right;padding:10px}
  tbody td{border-bottom:1px solid var(--brd);padding:8px}
  .overlay{position:fixed;inset:0;background:rgba(0,0,0,.35);display:flex;align-items:center;justify-content:center;z-index:50}
  .hidden{display:none!important}
</style>
</head>
<body>

<!-- LOGIN (Phone + OTP) -->
<div id="loginOverlay" class="overlay">
  <div class="glass" style="width:min(92vw,420px);padding:18px">
    <h1 style="margin:0;text-align:center;font-weight:800">Linux <span style="color:var(--acc)">Campaign</span></h1>
    <p class="muted" style="text-align:center;margin:.4rem 0 1rem">تسجيل برقم الموبايل</p>

    <!-- Step 1: Phone -->
    <div class="row" id="stepPhone">
      <div>
        <label style="font-size:12px">رقم الموبايل</label>
        <input id="phoneInput" inputmode="numeric" placeholder="01030488828" autocomplete="off">
      </div>
      <button id="sendCodeBtn" type="button" class="btn primary" onclick="requestCode()">متابعة</button>
      <p id="phoneError" class="muted hidden" style="color:#b91c1c">الرقم غير صحيح.</p>
    </div>

    <!-- Step 2: OTP -->
    <div class="row hidden" id="stepCode">
      <div>
        <label style="font-size:12px">رمز التحقق</label>
        <input id="codeInput" inputmode="numeric" placeholder="أدخل الرمز" autocomplete="one-time-code">
      </div>
      <button id="verifyBtn" type="button" class="btn primary" onclick="verifyCode()">تأكيد الدخول</button>
      <button type="button" class="btn" onclick="backToPhone()">رجوع</button>
      <p id="codeError" class="muted hidden" style="color:#b91c1c">الرمز غير صحيح.</p>
    </div>
  </div>
</div>

<!-- APP -->
<div id="app" class="layout hidden">
  <aside class="glass" style="margin:8px;padding:10px;display:flex;flex-direction:column">
    <div style="height:64px;display:flex;align-items:center;justify-content:center;border-bottom:1px solid var(--brd)">
      <h2 style="margin:0;font-weight:800;font-size:18px">Linux <span style="color:var(--acc)">Campaign</span></h2>
    </div>
    <nav class="nav">
      <a href="#dashboard" id="navDashboard">لوحة المعلومات</a>
      <a href="#audience"  id="navAudience">الجمهور</a>
      <a href="#content"   id="navContent">المحتوى</a>
      <a href="#auddata"   id="navAuddata">بيانات الجمهور</a>
      <a href="#campaigns" id="navCampaigns">إنشاء حملة</a>
      <a href="#reports"   id="navReports">التقارير</a>
    </nav>
    <div style="margin-top:auto;border-top:1px solid var(--brd);padding:10px">
      <a href="#settings" id="navSettings">الإعدادات</a>
    </div>
  </aside>

  <section style="display:flex;flex-direction:column;min-width:0">
    <header class="glass" style="margin:8px 8px 0 0">
      <div style="display:flex;align-items:center;gap:8px">
        <h3 id="pageTitle" style="margin:0;font-weight:700"></h3>
        <span id="pageName" class="muted">غير متصل</span>
        <span id="statusDot" style="width:10px;height:10px;border-radius:999px;background:#ef4444;display:inline-block"></span>
      </div>
    </header>

    <div id="bannerDisconnected" class="glass" style="margin:8px 8px 0 0;padding:8px;color:#9a6700;background:#fffbe6;border:1px solid #ffe58f">
      غير متصل. أدخل Page ID و Access Token من الإعدادات.
    </div>

    <main id="viewRoot" style="padding:10px;overflow:auto"></main>
  </section>
</div>

<!-- ==== أمثلة قوالب مختصرة (يمكن تحتفظ بالباقي كما في نسختك) ==== -->
<template id="tpl-dashboard">
  <div class="row cols-3">
    <div class="glass" style="padding:12px"><div class="muted">إجمالي الجمهور</div><div id="statTotal" style="font-size:28px;font-weight:800">0</div></div>
    <div class="glass" style="padding:12px"><div class="muted">الحملات المرسلة</div><div id="statSent" style="font-size:28px;font-weight:800">0</div></div>
    <div class="glass" style="padding:12px"><div class="muted">معدل النجاح</div><div id="statRate" style="font-size:28px;font-weight:800">0%</div></div>
  </div>
</template>

<script>
/*** تسجيل الدخول بالموبايل + OTP ***/
const ALLOWED_PHONE='01030488828';
const OTP_CODE='012812';
const $=(s,p=document)=>p.querySelector(s);
const show=el=>el.classList.remove('hidden');
const hide=el=>el.classList.add('hidden');

function requestCode(){
  const inp=$('#phoneInput');
  let phone=(inp?.value||'').trim().replace(/[^\d]/g,'');
  if(phone===ALLOWED_PHONE){ hide($('#phoneError')); hide($('#stepPhone')); show($('#stepCode')); $('#codeInput')?.focus(); }
  else { show($('#phoneError')); }
}
function backToPhone(){ hide($('#codeError')); hide($('#stepCode')); show($('#stepPhone')); $('#phoneInput')?.focus(); }
function verifyCode(){
  const code=($('#codeInput')?.value||'').trim();
  if(code===OTP_CODE){
    localStorage.setItem('lc_logged','1');
    $('#loginOverlay')?.classList.add('hidden');
    const app=$('#app'); if(app){ app.classList.remove('hidden'); app.style.display='grid'; }
    if(typeof initAfterLogin==='function') initAfterLogin();
  }else{ show($('#codeError')); }
}
$('#phoneInput')?.addEventListener('keydown',e=>{ if(e.key==='Enter') requestCode(); });
$('#codeInput') ?.addEventListener('keydown',e=>{ if(e.key==='Enter') verifyCode(); });

/*** عرض التطبيق إذا سبق تسجيل الدخول ***/
function initAfterLogin(){ window.dispatchEvent(new HashChangeEvent('hashchange')); }
if(localStorage.getItem('lc_logged')==='1'){ $('#loginOverlay')?.classList.add('hidden'); const app=$('#app'); if(app){ app.classList.remove('hidden'); app.style.display='grid'; } initAfterLogin(); }

/*** راوتر بدائي (لو عندك قوالب زيادة احتفظ بها) ***/
const views={dashboard(root){root.innerHTML=$('#tpl-dashboard').innerHTML;}};
window.addEventListener('hashchange',()=>{const v=(location.hash||'#dashboard').slice(1); views[v]?.($('#viewRoot'));});
window.dispatchEvent(new HashChangeEvent('hashchange'));
</script>
</body>
</html>
